<html>
 <head>
  <meta charset="utf8">
    <title>Query Expressions</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Harvard CGA QGIS 2.0 Workshop" />
        <meta name="keywords" content="QGIS,Quantum GIS,training" />
        <meta name="author" content="Lex Berman" />
        <!-- core JS -->
        <script src="../../assets/bootstrap/js/jquery.min.js"></script>
        <script src="../../assets/bootstrap/js/bootstrap.min.js"></script>    
        <!-- Bootstrap core CSS -->
        <link href="../../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
        <script src="../../assets/bootstrap/js/ie10-viewport-bug-workaround.js"></script>
        <!-- chgis custom CSS must appear AFTER bootstrap-->
        <link href="../../assets/css/qgis_2017.css" type="text/css" rel="stylesheet"> </head>
<body>
   <!-- navbar -->
     <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
         <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand hidden-xs" href="../../">QGIS WORKSHOP</a>
            <a class="navbar-brand visible-xs" href="../../">QGIS WORKSHOP</a>
         </div>
         <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li class="dropdown">
                 <a href="#" class="dropdown-toggle" data-toggle="dropdown">Install<b class="caret"></b></a>
                 <ul class="dropdown-menu">
                   <li><a href="../../install/linux">Linux</a></li>
                   <li><a href="../../install/mac">Mac OSX</a></li>
                   <li><a href="../../install/R">R with QGIS</a></li>
                   <li><a href="../../install/windows">Windows</a></li>
                 </ul>
               </li>
              <li class="dropdown">
                 <a href="#" class="dropdown-toggle" data-toggle="dropdown">Basic<b class="caret"></b></a>
                 <ul class="dropdown-menu">
                   <li><a href="../../basic/interface">User Interface</a></li>
                   <li><a href="../../basic/toolbars">Toolbars</a></li>
                   <li><a href="../../basic/panzoom">Pan Zoom Identify</a></li>
                   <li><a href="../../basic/select">Selection</a></li>
                   <li><a href="../../basic/query">Query Expressions</a></li>
                 </ul>
               </li>
              <li class="dropdown">
                 <a href="#" class="dropdown-toggle" data-toggle="dropdown">Task List<b class="caret"></b></a>
                 <ul class="dropdown-menu">
                   <li><a href="../../edit/vector_points">Edit: Vector Points</a></li>
                   <li><a href="../../import/basemap">Import: Add Basemap</a></li>
                   <li><a href="../../import/xy_from_csv">Import: X Y Points from CSV</a></li>
                   <li><a href="../../import/wms">Import: WMS Layer</a></li>
                   <li><a href="../../import/kml">Import: KML</a></li>
                   <li><a href="../../import/georef">Import: Scanned Map</a></li>
                   <li><a href="../../join/join_csv/">Join: Tabular Data</a></li>
                   <li><a href="../../join/join_spatial/">Join: Spatial Join</a></li>
                   <li><a href="../../projections/crs/">Projections: Coordinate Reference Systems</a></li>
                   <li><a href="../../projections/batch_reproject/">Projections: Batch Reprojection</a></li>
                 </ul>
               </li>                    
               <li><a href="../../data/">Data</a></li>
               <li><a href="../../links/">Links</a></li>  
            </ul>
         </div>
         <!--/.navbar-collapse -->
      </div>
   </div> 
   <!-- /navbar -->
 <div id="wrap">
  <div class="chunk">
    <article>
    <h2 id="query-expressions">Query Expressions</h2>
<div id="text_warn">
This tutorial page continues directly from the <a href="../select/">SELECTION</a> tutorial, so you will need to complete that first in order to have the data layers described below.
</div>

<div class="plain-text">
 <ul>
  <li><a href="#col">Column Filter</a></li>
  <li><a href="#qry">Query Builder</a></li>
  <li><a href="#exp">Expression Tool</a></li>
  <li><a href="#regex">Regular Expressions</a> </li>
 </ul>
</div>

<div class="text_anchor"><strong>Column Filter</strong><a id="col"></a></div>

<pre><code>Continuing from the previous section on SELECTING FEATURES, we have three layers of data added to our current QGIS project, and have done a spatial select to find 153 features.
</code></pre><div class="maps"><img src="../../assets/graf/select_pts.jpg"></div>

<pre><code>Right click on the active points layer, with the selected features, and OPEN THE ATTRIBUTE TABLE. Then scroll to the right until you can see the FULL_NAME_1 column.
</code></pre><div class="maps"><img src="../../assets/graf/attribute_table_arabic.jpg"></div>

<pre><code>The simplest way to search for a word (or string) in QGIS 2.0 is to use Column Filter. From the bottom left drop-down menu, select COLUMN FILTER. Scroll right to the Columns List, then select the FIELD NAME you want to search in.
</code></pre><div class="maps"><img src="../../assets/graf/attribute_table_filter.jpg">
</div>

<pre><code>1. You will see a blank form where you can type in the string to be searched for

2. In this example, we are filtering for Passage and have left the case sensitive option checked

3. Click APPLY to run the search
</code></pre><div class="maps"><img src="../../assets/graf/attribute_table_filter_apply.jpg">
</div>

<pre><code>Only two records were found that contained the string Passage. If you change the query string to Pass and hit APPLY again, an additional row will be found, Daiqa Pass. This means that the search is essentially allowing for any characters to precede or to follow the search term (the equivalent of a wildcard like %Pass% )
</code></pre><div class="text_anchor"><strong>Query Builder</strong><a id="qry"></a></div>

<pre><code>Another way to run queries in QGIS is QUERY BUILDER. First DESELECT ALL the features, then Right-click on the points layer (egypt_gns) and go to PROPERTIES, then the GENERAL TAB. You may need to scroll down to the lower right to launch QUERY BUILDER.
</code></pre><div class="maps"><img src="../../assets/graf/qry_1.jpg">
</div>

<pre><code>1. In the FIELDS form, scroll down and double-click on FULL_NAME_1

2. The Field Name should appear in the expression form near the bottom of the window

3. Click once on the operator button LIKE, which should appear in the expression form

4. Move your cursor to click after the word LIKE in the expression window

5. Type in your search string wrapped by SINGLE QUOTES and the wildcard %, for example: &#39;%Pass%&#39;

6. Click TEST which will validate the expression and show number of rows found when run
</code></pre><div class="maps"><img src="../../assets/graf/qry_2.jpg">
</div>

<pre><code>Clicking OK will close the TEST results, then click OK. You will be back on the GENERAL tab, with your Query Shown in the Provider Feature Filter.  Click APPLY to run the query, and OK to close the Layer Properties.  Now take a look at your map view and attribute table, which will show the rows selected using QUERY BUILDER.
</code></pre><div class="maps"><img src="../../assets/graf/qry_3.jpg">
</div>

<pre><code>Note that the Query Builder has HIDDEN all the remaining features.   You can always right click on the Layer and go to Properties | General | Query Builder and click the CLEAR button, which will restore your complete layer of features.
</code></pre><div class="text_anchor"><strong>Expression Tool</strong><a id="exp"></a></div>

<pre><code>The COLUMN FILTER and QUERY BUILDER are essential User Interfaces that provide limited subsets of the querying and filtering functionality of QGIS. You can also make use of QGIS finer grained querying power, using the EXPRESSION tool user interface, or by running your own custom Python scripts with the same operators and functions. Let&#39;s see how the same query can select features using EXPRESSION. First, reset your attribute table on the lower left drop-down menu to SHOW ALL FEATURES. Then click on the EXPRESSION button to open the SQL Expression window.
</code></pre><div class="maps"><img src="../../assets/graf/attribute_table_exp.jpg"></div>

<pre><code>If you know which query operator, conditional or function you want to use, you can type it into the search bar above the FUNCTION LIST. For example, we can try typing LIKE. When you type LIKE into the search box, the term will be shown under it&#39;s parent group, OPERATORS.

Double-click on LIKE in the FUNCTION LIST to add it to your Expression form. You will see that a warning appears below the Expression form, indicating that the Expression is Invalid. This is very useful to see if you are constructing valid query expressions. Now move the cursor to the beginning of the Expression form, before LIKE, so we can add the FIELD NAME to be searched in.
</code></pre><div class="maps"><img src="../../assets/graf/exp_1.jpg">
</div>

<pre><code>First, be sure to REMOVE or DELETE the word LIKE from the Search Box above the function list! (Otherwise the Function groups will not be expandable trees because they do not contain the term LIKE.)

Next expand the list of FIELDS AND VALUES in the Function List. Scroll down to find the field called FULL_NAME_1 and double-click on it. The Field Name should be added to the beginning of the Expression Form.
</code></pre><div class="maps"><img src="../../assets/graf/exp_2.jpg">
</div>

<pre><code>Now move the cursor to the right side of LIKE and type the search term within SINGLE QUOTES, and with the wildcard % before and after the term: &#39;%Passage%&#39;. Your expression should read: &quot;FULL_NAME_1&quot; LIKE &#39;%Passage%&#39; The Expression validation warning will disappear if this query expression is valid.
</code></pre><div class="maps"><img src="../../assets/graf/exp_3.jpg">
</div>

<pre><code>Click SELECT to run the query. 

Return to the Attribute Table and use the drop-down on the lower left to SHOW SELECTED FEATURES.  In this example only two records matched the string &#39;Passage&#39; in the FULL_NAME_1 field. 

Now click the DESELECT ALL button.  Return to the EXPRESSION tool to search for &#39;Pass&#39; and you should find three rows selected.
</code></pre><div class="text_anchor"><strong>Regular Expressions</strong><a id="regex"></a></div>

<div class="plain-text">
<strong>Use Regex in QGIS following the <a href="http://docs.python.org/2/library/re.html">Python Regex rules</a></strong>.
</div>

<pre><code class="lang-`">QGIS provides the full extent of REGEX functionality, including the ability to run complex queries, maths, and search-replace operations. Just to get started, let&#39;s run a similar query with the regex function.

  1. Click on the EXPRESSION button to open the tool

  2. Type regex in the search box, then double-click on regexp_match

  3. Delete the term regex from the search box, then expand the Fields and Values tree
Scroll down and double-click on the field to be searched, FULL_NAME_1

 4. Move your cursor to click after &quot;FULL_NAME_1&quot; in the expression window
Type in the rest of the regex phrase, for example: ,&#39;Pass$&#39;)

 5. The syntax is:  regexp_match(&quot;FIELDNAME&quot;,&#39;regex&#39;)

in this case:
regexp_match(&quot;FULL_NAME_1&quot;,&#39;Pass$&#39;)

 6. Click SELECT to run the query

Note, the sample query above will find only ONE record, because the term Pass is followed by the $ flag, which indicates it is the END of the text being searched for. 

If you DESELECT and try &#39;Pass&#39; you should find three records, etc.
</code></pre>
<div class="maps"><img src="../../assets/graf/exp_4.jpg">
</div>

<div class="plain-text">
See the documentation on <strong><a href="https://docs.qgis.org/2.18/en/docs/user_manual/working_with_vector/expression.html">QGIS Expressions</a></strong> for lots of great functions!  For example, the geometry functions will calculate the area of all polygons using the $area function.
</div>


<p><hr></p>
<div class="plain-text">
<strong>Proceed to the <a href="../../import">IMPORTING DATA</a> section</strong>
</div>
    </article>
   </div>
 </div>

        <div class="footer navbar-fixed-bottom">
           <div class="text-center"><font size=-1>
             <p>&copy; QGIS Workshop 2012 - <script>document.write(new Date().getFullYear())</script>
             &nbsp; &nbsp;  hosted by: <a href="https://gis.harvard.edu" target="_new" title="Harvard Center for Geographic Analysis">CGA</a></font>
             &nbsp; &nbsp;  author: <a href="http://www.gis.harvard.edu/people/merrick-lex-berman" target="_new">Lex Berman</a></font>
             </p>
           </div>
        </div></body>
</html>